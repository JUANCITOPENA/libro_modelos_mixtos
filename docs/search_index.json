[
["reg-diagnos.html", "6 Diagnóstico del modelo de regresión de efectos mixtos 6.1 Los residuos 6.2 Diagnóstico del modelo de regresión: prueba de hipótesis e inferencia visual", " 6 Diagnóstico del modelo de regresión de efectos mixtos El diagnóstico del modelo de regresión es un método que permite determinar si un modelo de regresión ajustado representa adecuadamente los datos. El objetivo de este capitulo consiste en introducir al lector los distintos métodos de diagnostico del modelo, los cuales permitiran identificar aquel modelo que represente sus datos con una mayor precisión. 6.1 Los residuos Los residuos son la base de la mayoría de los métodos de diagnóstico. Estos pueden ser de distinto tipo. Los residuos más básicos son los denominados residuos ordinarios, \\(\\hat{\\epsilon}_{i}\\), el cual se define como la diferencia entre el valor observado, \\(y_{i}\\), y su correspondiente valor estimado por el modelo, \\(\\hat{\\mu}_{i}\\), así: \\[\\begin{align*} \\hat{\\epsilon}_{i} = y_{i} - \\hat{\\mu}_{i}, i = 1, 2, ..., n \\end{align*}\\] donde \\(\\hat{\\mu}_{i}\\) es igual a \\(x^{&#39;}_{i}\\hat{\\beta}\\). A continuación, se presenta una representación gráfica de \\(\\hat{\\epsilon}_{i}\\): Figure 6.1: Representación gráfica de los residuos, del valor estimado y del valor observado. Luego los residuos ordinarios se escalan con el fin de que su interpretación no dependa de las unidades de medida de la variable dependiente. El proceso de estandarización consiste en dividir el residuo ordinario, \\(\\hat{\\epsilon}_{i}\\), por la expresión \\(\\sigma\\sqrt{(1-h_{i})}\\), donde \\({\\sigma}\\) corresponde a la desviación estandar verdadera y \\(h_{i}\\) al apalancamiento o valor de sombrero. Los residuos obtenidos de esta manera se denominan como residuos estandarizados. Sin embargo la verdadera desviación estándar rara vez se conoce. Por lo tanto, el escalado se puede realizar utilizando un estimador del mismo, es decir \\(\\hat{\\sigma}\\). Los residuos obtenidos de esta manera se denominan como residuos estudentizados, los cuales a su vez se dividen en dos: los residuos internamente estudentizados y los residuos externamente estudentizados. La tabla a continuación, resume las formas básicas de los residuos escalados: Formula matemática Estandarizado \\(\\frac{\\hat\\epsilon_i}{\\sigma\\sqrt{(1-h_i)}}\\) Internamente estudentizado \\(\\frac{\\hat\\epsilon_i}{\\hat\\sigma\\sqrt{(1-h_i)}}\\) Externamente estudentizado \\(\\frac{\\hat\\epsilon_i}{\\hat\\sigma_{(-i)}\\sqrt{(1-h_i)}}\\) * En el residuo internamente estudentizado, \\(\\hat\\sigma\\) denota una estimación de \\(\\sigma\\) basada en todas las observaciones; † En el residuo externamente estudentizado, \\(\\hat\\sigma_{(-i)}\\) es una estimación obtenida luego de excluir la i-ésima observación de los cálculos. Se usara la base de datos hsb del paquete merTools para entender mejor de que tratan los residuos, así como también los métodos de diagnosticos que explicaremos más adelante en este capitulo. A continuación podra ver la base de datos a usar: Se puede entender bien la lógica de los que son los residuos ajustando un modelo de regresión simple. El diagnóstico del modelo de regresión aborda la adecuación de un modelo estadístico una vez se han ajustado los datos. De hecho, el ajuste de un modelo debe verse como un proceso iterativo en el que se ajusta el modelo, se evalúan sus residuos y se mejora. Así hasta llegar a un modelo óptimo. Suponga que se quiere poner en relación dos variables: la variable \\(x_{1}\\) que representa el nivel socio-económico de los estudiantes (ses), y la variable \\(y\\), que es el rendimiento de los mismos estudiantes en una prueba de matemáticas (mathach). Para facilitar este análisis (y los posteriores) se asumira que \\(x_{1}\\) es una variable continua que toma valores entre -4 y +4, donde valores cercanos a 0 indican nivel socio-económico medio, cercanos a +4 indican nivel socio-económico alto y cercanos a -4 indican nivel socio-económico bajo. El modelo de regresión simple aplicado a este ejemplo se puede representar así: \\[\\begin{align} \\label{mod2} y_i &amp;\\sim N(\\mu_i, \\sigma^2), \\\\ \\mu_i &amp;= \\beta_0 + \\beta_1 x_{1i}, \\\\ \\sigma^2 &amp;= \\text{constante} \\end{align}\\] El codigó en R para ajustar el anterior modelo se presenta a continuación: Modelo_simple &lt;- lm(mathach ~ ses, data = hsb) summary(Modelo_simple) ## ## Call: ## lm(formula = mathach ~ ses, data = hsb) ## ## Residuals: ## Min 1Q Median 3Q Max ## -19.4382 -4.7580 0.2334 5.0649 15.9007 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## (Intercept) 12.74740 0.07569 168.42 &lt;2e-16 *** ## ses 3.18387 0.09712 32.78 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 6.416 on 7183 degrees of freedom ## Multiple R-squared: 0.1301, Adjusted R-squared: 0.13 ## F-statistic: 1075 on 1 and 7183 DF, p-value: &lt; 2.2e-16 Luego, los residuos (en este caso los residuos ordinarios) se pueden obtener con las siguientes funciones genericas: muestra_aleatoria$val_predicho &lt;- predict(Modelo_simple) muestra_aleatoria$res_ordinario &lt;- residuals(Modelo_simple) La gráfica a continuación presenta los valores observados y estimados en el rendimiento de los estudiantes en una prueba de matemáticas según su nivel socio-económico, siendo la misma una representación gráfica similar a la presentada en la Figura 6.1: Tenga en cuenta que se bien el modelo se ajusto con las 7185 valores observados, la gráfica a continuación solo presenta 150 valores. Esto debido a que al no restringir por este valor, la gráfica se presentaba muy saturada de valores observados y estimados. Figure 6.2: Valores obserados y estimados en el rendimiento en una prueba matemática según el nivel socio-económico del estudiante. La gráfica anterior representa la relación existente entre el rendimiento académico y el nivel socio-económico del estudiante. Claramente se puede observar que a mayor nivel socio-económico, mejor es el rendimiento del estudiante. Una vez ajustado el modelo de regresión, y como se puede observar en la anterior gráfica, se tienen los valores observados (puntos con relleno), los valores estimados (puntos sin relleno) y el residuo (representado por una línea vertical que une a los valores observados con los estimados). Por tanto, puede imaginar ahora que cada dato (valor observado) tiene un valor estimado y un residuo (residuo ordinario en este caso) como se detalla a continuación: Rendimiento real Rendimiento estimado Residuo ordinario 9.670 16.44451 -6.774512 24.488 17.39127 7.096730 12.500 11.01095 1.489052 23.231 15.78590 7.445102 Luego dichos residuos se consideran como elementos clave en la evaluación del modelo ajustado. Estos suelen emplearse en los métodos de diagnosticos del modelo de regresión mediante pruebas de hipótesis acompañadas de inferencia visual (gráficos). Por ejemplo, la figura a continuación muestra una de las gráficas comunmente usadas en los métodos de diagnostico: Figure 6.3: Grafica de residuos ordinarios vs Valores estimados. Existe una gran variedad de gráficos (como la presentada anteriormente) lo que refleja el hecho de que ningún gráfico de diagnóstico es apropiado para todos los propósitos. Veremos la interpretación de la misma con más detalle a continuación. 6.2 Diagnóstico del modelo de regresión: prueba de hipótesis e inferencia visual Como es sabido, la inferencia estadística clásica consiste en formular inicialmente un juego de hipótesis (hipótesis nula y alternativa), y calcular posteriormente un estadístico de prueba del cual se deriva un valor p que permitira concluir en relación a las hipótesis planteadas. Este proceso tiene su análogo en inferencia visual. Suponga que el interés consiste en verificar alguna suposición sobre el modelo ajustado, por ejemplo, la homogeneidad de la varianza residual. Para ello se plantea como hipótesis nula el cumplimiento de dicha homogeneidad, mientras que la hipótesis alternativa abarca cualquier violación de este supuesto. Para la inferencia visual, el estadístico de prueba corresponde a una gráfica que muestra un aspecto del supuesto que se desea verifcar, y permite al observador distinguir entre escenarios bajo la hipótesis nula y la alternativa. A continuación se mostrará como llevar a cabo el diagnónostico del modelo de regresión empleando tanto pruebas de hipótesis como inferencia visual. Para ello, haremos uso de nuevo de la base de datos anteriormente mencionada hsb. 6.2.1 Ajustando el modelo Vimos anteriormente en este capitulo que era posible determinar si el rendimiento de los estudiantes en una prueba de matemáticas (mathach) estaba relacionada con su nivel socio-económico (ses). Se considerará ahora la posibilidad de que la relación entre el rendimiento y el nivel socio-económico del estudiante varien según las características de la escuela, específicamente, si la escuela es una escuela pública o una escuela privada (schtype). Un buen punto de partida consiste es ver la relación entre el rendimiento y el nivel socio-económico por separado para cada escuela: Figure 6.4: Diagrama de dispersión del rendimiento matemático según el nivel socio-económico en escuelas públicas. Figure 6.5: Diagrama de dispersión del rendimiento matemático según el nivel socio-económico en escuelas privadas. En cada panel, la línea representa un ajuste lineal por mínimos cuadrados a los datos. El número en la parte superior corresponde a la identificación de la escuela (en este caso se han elegido doce escuelas para cada tipo). Claramente parece haber una diferencia entre la escuelas públicas y privadas: las líneas para las escuelas públicas parecen tener pendientes más pronunciadas. Esto hace pensar que un modelo de efectos mixtos con intercepto y pendiente aleatoria podría ser adecuado para modelar este tipo de datos. Por tal motivo, el modelo de regresión de efectos mixtos aplicado a este ejemplo se puede representar así: \\[\\begin{align*} y_{ij} &amp;\\sim N(\\mu_{ij}, \\sigma^2), \\\\ \\mu_{ij} &amp;= \\beta_0 + \\beta_1 x_{ij} + b_{0i} + b_{1i} x_{ij}, \\\\ \\left ( \\begin{matrix} b_{0} \\\\ b_{1} \\end{matrix} \\right ) &amp;\\sim N\\left ( \\left [ \\begin{matrix} 0 \\\\ 0 \\end{matrix} \\right ], \\left [ \\begin{matrix} \\sigma^2_{b0} &amp; \\sigma_{b01} \\\\ \\sigma_{b01} &amp; \\sigma^2_{b1} \\end{matrix} \\right ] \\right ) \\end{align*}\\] Esta ecuación representa la relación existente entre el rendimiento acádemico y el nivel socio-económico de los estudiantes. La variable respuesta, \\(y_{ij}\\), es el rendimiento del estudiante, \\(i\\), en la escuela \\(j\\). El codigó en R para ajustar el anterior modelo se presenta a continuación. Se hara uso del paquete lme4 ya mencionado en el capitulo 3 del presente libro: library(lme4) Modelo_mixto &lt;- lmer(mathach ~ ses + (ses | schtype), REML = TRUE, data = hsb) La siguiente figura, obtenida a partir del modelo anteriormente ajustado, pone de manifiesto la posibilidad real y plausible de que el intercepto y la pendiente varíen según las características de cada escuela (privada o pública): Figure 6.6: Grafica del modelo de regresión ajustado para dos escuelas. 6.2.2 Gráfica básica de diagnóstico La gráfica de residuos contra los valores ajustados se considera la gráfica de diagnótico más básica. Grafica_A ggplot(data = hsb, aes(x = val_estimado, y = res_ordinario)) + geom_point(alpha = 0.4, size = 2.0) + stat_smooth(method = \"loess\", se = FALSE, color = \"red\", size = 0.8) + geom_hline(yintercept = 0, color = \"black\", linetype = \"dashed\", size = 0.8) + labs(x = \"Valores estimados\", y = \"Residuos ordinarios\", title = \"A\") + theme_bw() + theme(axis.text = element_text(size = 8, face = \"bold\"), axis.title = element_text(size = 8, face = \"bold\"), plot.title = element_text(size = 8, face = \"bold\")) Grafica_B ggplot(data = hsb, aes(x = schtype, y = res_ordinario, color = schtype, fill = schtype)) + geom_boxplot(alpha = 0.4) + scale_color_manual(values = c(\"black\", \"yellow\")) + scale_fill_manual(values = c(\"black\", \"yellow\")) + theme(legend.position = \"none\") + labs(x = \"Característica de la escuela\", y = \"Residuos ordinarios\", title = \"B\") + theme_bw() + theme(axis.text = element_text(size = 8, face = \"bold\"), axis.title = element_text(size = 8, face = \"bold\"), plot.title = element_text(size = 8, face = \"bold\"), legend.text = element_text(size = 6, face = \"bold\"), legend.title = element_text(size = 6, face = \"bold\")) Figure 6.7: Gráficos residuales para el modelo de efectos mixtos (a) entre los residuos ordinarios contra los valores estimados (b) residuos ordinarios en cada tipo de escuela (c) residuos pearson contra los valores estimados (d) residuos pearson en cada tipo de escuela. Los métodos utilizados comúnmente en el diagnóstico residual son gráficos, que se evalúan informalmente con respecto a la presencia o ausencia de patrones específicos y/o puntos de datos periféricos. Dichos gráficos pueden basarse en varios tipos de residuos, como los residuos ordinarios o pearson. "]
]
